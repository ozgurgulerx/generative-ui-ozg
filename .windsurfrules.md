# .windsurfrules  (place in the repo root)
# Purpose: drive high-quality, low-regression changes and deep, task-focused execution.

## Operating principles
1) Plan-first: before editing, produce a brief TODO/plan with sub-steps, risks, test impact, and rollback.
2) Small, reversible diffs: prefer surgical changes; avoid sweeping refactors unless explicitly asked.
3) Respect architecture: follow existing module boundaries and public APIs; keep layering intact.
4) Determinism: avoid non-reproducible steps; pin versions; don’t depend on network at test time.

## Code quality guardrails
5) Types: add/maintain full type coverage (TS: strict; Python: typing + mypy-clean if configured).
6) Lint/format: run the project linters/formatters and leave the tree clean.
7) Tests: for any behavior change, add/adjust unit tests + one high-value integration test when feasible.
8) Contracts: preserve function signatures, error semantics, and documented behaviors.
9) Performance: flag any change with >1 big-O step up or obvious hot-path allocations; propose alternatives.

## Security & safety
10) No secrets in code, logs, or tests; use env vars and secret stores already used by the project.
11) Input handling: validate and sanitize external inputs; assume untrusted by default.
12) Dependency hygiene: prefer existing libs; if adding, justify and update lockfiles.

## Task execution protocol
13) When given a task:
    - Restate the goal, constraints, and acceptance tests in the chat.
    - Identify files to touch; explain why.
    - Execute incrementally: edit → run checks → report status and next step.
14) If the plan is blocked (API ambiguity, missing schema), stop and ask for one precise clarification.

## Project specifics (update these)
15) Build command: <replace_with_your_command>  (e.g., `pnpm build` or `uv run -m build`)
16) Test command: <replace_with_your_command>   (e.g., `pnpm test -w` or `pytest -q`)
17) Lint/format: <replace_with_your_command>    (e.g., `pnpm lint && pnpm format` or `ruff check && ruff format`)
18) Critical directories not to touch without approval: <e.g., `/infra`, `/migrations`, `/generated`>
19) Style conventions & patterns to follow (examples): 
    - React: function components, hooks only, no default exports; co-locate tests as `*.test.tsx`.
    - Python: raise typed Exceptions; log with structured context; avoid `print`.

## Definition of done (block merge if not met)
20) All tests green; linters/formatters pass.
21) Added/updated tests cover the new path and prior bug class.
22) Updated docs: READMEs, inline docstrings, and changelog notes where relevant.
23) Brief summary in chat: what changed, why it’s safe, how to roll back.

# End of rules
